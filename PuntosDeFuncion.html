<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Puntos de Funci√≥n y L√≠neas de C√≥digo</title>
    <style>
        :root {
            /* Primitive Color Tokens */
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-teal-800: rgba(41, 150, 161, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-400: rgba(230, 129, 97, 1);
            --color-orange-500: rgba(168, 75, 47, 1);

            /* RGB versions for opacity control */
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-slate-500-rgb: 98, 108, 113;
            --color-red-500-rgb: 192, 21, 47;
            --color-red-400-rgb: 255, 84, 89;
            --color-orange-500-rgb: 168, 75, 47;
            --color-orange-400-rgb: 230, 129, 97;

            /* Background color tokens (Light Mode) */
            --color-bg-1: rgba(59, 130, 246, 0.08);
            --color-bg-2: rgba(245, 158, 11, 0.08);
            --color-bg-3: rgba(34, 197, 94, 0.08);
            --color-bg-4: rgba(239, 68, 68, 0.08);
            --color-bg-5: rgba(147, 51, 234, 0.08);
            --color-bg-6: rgba(249, 115, 22, 0.08);
            --color-bg-7: rgba(236, 72, 153, 0.08);
            --color-bg-8: rgba(6, 182, 212, 0.08);

            /* Semantic Color Tokens (Light Mode) */
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
            --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
            --color-error: var(--color-red-500);
            --color-success: var(--color-teal-500);
            --color-warning: var(--color-orange-500);
            --color-info: var(--color-slate-500);
            --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
            --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

            /* Common style patterns */
            --focus-ring: 0 0 0 3px var(--color-focus-ring);
            --focus-outline: 2px solid var(--color-primary);
            --status-bg-opacity: 0.15;
            --status-border-opacity: 0.25;
            --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

            /* RGB versions for opacity control */
            --color-success-rgb: 33, 128, 141;
            --color-error-rgb: 192, 21, 47;
            --color-warning-rgb: 168, 75, 47;
            --color-info-rgb: 98, 108, 113;

            /* Typography */
            --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            --font-size-xs: 11px;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-md: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-size-3xl: 24px;
            --font-size-4xl: 30px;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 550;
            --font-weight-bold: 600;
            --line-height-tight: 1.2;
            --line-height-normal: 1.5;
            --letter-spacing-tight: -0.01em;

            /* Spacing */
            --space-0: 0;
            --space-1: 1px;
            --space-2: 2px;
            --space-4: 4px;
            --space-6: 6px;
            --space-8: 8px;
            --space-10: 10px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --space-32: 32px;

            /* Border Radius */
            --radius-sm: 6px;
            --radius-base: 8px;
            --radius-md: 10px;
            --radius-lg: 12px;
            --radius-full: 9999px;

            /* Shadows */
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
            --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.03);

            /* Animation */
            --duration-fast: 150ms;
            --duration-normal: 250ms;
            --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);

            /* Layout */
            --container-sm: 640px;
            --container-md: 768px;
            --container-lg: 1024px;
            --container-xl: 1280px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-400-rgb: 119, 124, 124;
                --color-teal-300-rgb: 50, 184, 198;
                --color-gray-300-rgb: 167, 169, 169;
                --color-gray-200-rgb: 245, 245, 245;
                --color-bg-1: rgba(29, 78, 216, 0.15);
                --color-bg-2: rgba(180, 83, 9, 0.15);
                --color-bg-3: rgba(21, 128, 61, 0.15);
                --color-bg-4: rgba(185, 28, 28, 0.15);
                --color-bg-5: rgba(107, 33, 168, 0.15);
                --color-bg-6: rgba(194, 65, 12, 0.15);
                --color-bg-7: rgba(190, 24, 93, 0.15);
                --color-bg-8: rgba(8, 145, 178, 0.15);
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-primary-active: var(--color-teal-800);
                --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
                --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
                --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-error: var(--color-red-400);
                --color-success: var(--color-teal-300);
                --color-warning: var(--color-orange-400);
                --color-info: var(--color-gray-300);
                --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
                --color-btn-primary-text: var(--color-slate-900);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
                --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
                --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -1px 0 rgba(0, 0, 0, 0.15);
                --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);
                --color-success-rgb: var(--color-teal-300-rgb);
                --color-error-rgb: var(--color-red-400-rgb);
                --color-warning-rgb: var(--color-orange-400-rgb);
                --color-info-rgb: var(--color-gray-300-rgb);
            }
        }

        html {
            font-size: var(--font-size-base);
            font-family: var(--font-family-base);
            line-height: var(--line-height-normal);
            color: var(--color-text);
            background-color: var(--color-background);
            -webkit-font-smoothing: antialiased;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
        }

        *, *::before, *::after {
            box-sizing: inherit;
        }

        h1, h2, h3, h4, h5, h6 {
            margin: 0;
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-tight);
            color: var(--color-text);
            letter-spacing: var(--letter-spacing-tight);
        }

        h1 { font-size: var(--font-size-4xl); }
        h2 { font-size: var(--font-size-3xl); }
        h3 { font-size: var(--font-size-2xl); }
        h4 { font-size: var(--font-size-xl); }
        h5 { font-size: var(--font-size-lg); }
        h6 { font-size: var(--font-size-md); }

        p {
            margin: 0 0 var(--space-16) 0;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-8) var(--space-16);
            border-radius: var(--radius-base);
            font-size: var(--font-size-base);
            font-weight: 500;
            line-height: 1.5;
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-standard);
            border: none;
            text-decoration: none;
            position: relative;
        }

        .btn:focus-visible {
            outline: none;
            box-shadow: var(--focus-ring);
        }

        .btn--primary {
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
        }

        .btn--primary:hover {
            background: var(--color-primary-hover);
        }

        .btn--primary:active {
            background: var(--color-primary-active);
        }

        .btn--secondary {
            background: var(--color-secondary);
            color: var(--color-text);
        }

        .btn--secondary:hover {
            background: var(--color-secondary-hover);
        }

        .btn--lg {
            padding: var(--space-10) var(--space-20);
            font-size: var(--font-size-lg);
            border-radius: var(--radius-md);
        }

        .btn--full-width {
            width: 100%;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .form-control {
            display: block;
            width: 100%;
            padding: var(--space-8) var(--space-12);
            font-size: var(--font-size-md);
            line-height: 1.5;
            color: var(--color-text);
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            transition: border-color var(--duration-fast) var(--ease-standard), box-shadow var(--duration-fast) var(--ease-standard);
        }

        select.form-control {
            padding: var(--space-8) var(--space-12);
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: var(--select-caret-light);
            background-repeat: no-repeat;
            background-position: right var(--space-12) center;
            background-size: 16px;
            padding-right: var(--space-32);
        }

        .form-control:focus {
            border-color: var(--color-primary);
            outline: var(--focus-outline);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-8);
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-sm);
        }

        .form-group {
            margin-bottom: var(--space-16);
        }

        .card {
            background-color: var(--color-surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-card-border);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: box-shadow var(--duration-normal) var(--ease-standard);
        }

        .card__body {
            padding: var(--space-16);
        }

        .container {
            width: 100%;
            margin-right: auto;
            margin-left: auto;
            padding-right: var(--space-16);
            padding-left: var(--space-16);
            max-width: var(--container-xl);
        }

        .flex {
            display: flex;
        }
        .flex-col {
            flex-direction: column;
        }
        .items-center {
            align-items: center;
        }
        .justify-center {
            justify-content: center;
        }
        .justify-between {
            justify-content: space-between;
        }
        .gap-16 {
            gap: var(--space-16);
        }
        .text-center {
            text-align: center;
        }
        .hidden {
            display: none;
        }

        /* Custom Styles */
        .app-header {
            text-align: center;
            padding: var(--space-32) 0;
            background: var(--color-bg-1);
        }

        .app-section {
            padding: var(--space-32) 0;
        }

        .section-title {
            margin-bottom: var(--space-24);
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--color-border);
            margin-bottom: var(--space-24);
        }

        .tab {
            padding: var(--space-12) var(--space-16);
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all var(--duration-fast) var(--ease-standard);
        }

        .tab.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--space-16);
        }

        .table th,
        .table td {
            padding: var(--space-8) var(--space-12);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        .table th {
            background-color: var(--color-bg-2);
            font-weight: var(--font-weight-medium);
        }

        .table input {
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            padding: var(--space-4) var(--space-8);
            width: 100%;
        }

        .gsc-item {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-base);
            padding: var(--space-16);
            margin-bottom: var(--space-16);
        }

        .gsc-scale {
            display: flex;
            gap: var(--space-8);
            margin-top: var(--space-8);
        }

        .gsc-scale input[type="radio"] {
            width: var(--space-16);
            height: var(--space-16);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-16);
            margin-bottom: var(--space-24);
        }

        .result-card {
            background: var(--color-surface);
            padding: var(--space-16);
            border-radius: var(--radius-base);
            border: 1px solid var(--color-card-border);
        }

        .result-value {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
        }

        .progress-indicator {
            background: var(--color-bg-3);
            border-radius: var(--radius-full);
            padding: var(--space-4) var(--space-12);
            font-size: var(--font-size-sm);
            color: var(--color-success);
            margin-bottom: var(--space-16);
            position: relative;
        }
        
        .progress-indicator::after {
            content: '';
            position: absolute;
            left: -4px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 100%;
            background: var(--color-success);
            border-radius: 2px;
        }
        
        /* Enhanced visual feedback */
        .gsc-question {
            transition: all 0.3s ease;
        }
        
        .gsc-question:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .gsc-option {
            transition: all 0.2s ease;
        }
        
        .gsc-option:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .table tr:hover {
            background: var(--color-bg-1);
        }
        
        .btn {
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn:active::after {
            animation: ripple 0.6s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 1;
            }
            20% {
                transform: scale(25, 25);
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: scale(40, 40);
            }
        }
        
        @keyframes slideInRight {
            0% {
                opacity: 0;
                transform: translateX(100%);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* Breadcrumb navigation */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            padding: 12px;
            background: var(--color-bg-1);
            border-radius: 8px;
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: var(--color-text-secondary);
        }
        
        .breadcrumb-item.active {
            color: var(--color-primary);
            font-weight: 600;
        }
        
        .breadcrumb-separator {
            color: var(--color-border);
        }

        .help-text {
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
            margin-top: var(--space-4);
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 300px;
            background-color: var(--color-charcoal-800);
            color: var(--color-gray-200);
            text-align: left;
            border-radius: var(--radius-base);
            padding: var(--space-8);
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity var(--duration-normal);
            font-size: var(--font-size-sm);
            line-height: 1.4;
            box-shadow: var(--shadow-lg);
        }

        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--color-charcoal-800) transparent transparent transparent;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .help-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: var(--color-info);
            color: var(--color-white);
            font-size: 10px;
            font-weight: bold;
            margin-left: var(--space-4);
            cursor: help;
        }

        .help-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .help-modal-content {
            background-color: var(--color-surface);
            margin: 5% auto;
            padding: var(--space-24);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: var(--color-text-secondary);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: var(--color-text);
        }

        .gsc-detailed {
            margin-bottom: var(--space-16);
        }

        .gsc-criteria {
            background: var(--color-bg-1);
            border-radius: var(--radius-base);
            padding: var(--space-12);
            margin-top: var(--space-8);
            font-size: var(--font-size-sm);
        }

        .gsc-scale-detailed {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: var(--space-8);
            margin-top: var(--space-12);
        }

        .gsc-option {
            text-align: center;
            padding: var(--space-8);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .gsc-option:hover {
            background-color: var(--color-secondary);
        }

        .gsc-option input[type="radio"] {
            margin-bottom: var(--space-4);
        }

        .gsc-option.selected {
            background-color: var(--color-primary);
            color: var(--color-btn-primary-text);
            border-color: var(--color-primary);
        }

        .definition-box {
            background: var(--color-bg-3);
            border: 1px solid var(--color-success);
            border-radius: var(--radius-base);
            padding: var(--space-12);
            margin-bottom: var(--space-16);
        }

        .examples-list {
            margin-top: var(--space-8);
            padding-left: var(--space-16);
        }

        .complexity-matrix {
            background: var(--color-bg-2);
            border-radius: var(--radius-base);
            padding: var(--space-12);
            margin-top: var(--space-8);
            font-size: var(--font-size-sm);
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: var(--space-32);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- P√ÅGINA PRINCIPAL -->
        <section id="home-section" class="app-section">
            <div class="container">
                <div class="app-header">
                    <h1>üßÆ Calculadora de Puntos de Funci√≥n y L√≠neas de C√≥digo</h1>
                    <p>Herramienta profesional para estimar el tama√±o y complejidad de proyectos de software basada en el est√°ndar IFPUG</p>
                    
                    <div style="margin: 16px 0; padding: 12px 16px; background: var(--color-bg-3); border-radius: 8px; max-width: 600px; margin-left: auto; margin-right: auto; border-left: 4px solid var(--color-success);">
                        <h5 style="margin: 0 0 8px 0; color: var(--color-success); font-size: 14px;">üíæ Sistema de Auto-Guardado Inteligente</h5>
                        <p style="margin: 0; font-size: 13px; color: var(--color-text-secondary);">Tu progreso se guarda autom√°ticamente cada 30 segundos y est√° protegido contra cierre accidental de la p√°gina. Usa Ctrl+S para guardar manualmente.</p>
                    </div>
                    
                    <div style="margin: 24px 0; padding: 16px; background: var(--color-bg-4); border-radius: 8px; max-width: 600px; margin-left: auto; margin-right: auto;">
                        <h4>üéØ ¬øQu√© puedes hacer?</h4>
                        <ul style="text-align: left; margin: 8px 0; padding-left: 20px;">
                            <li>Calcular Puntos de Funci√≥n con criterios detallados IFPUG</li>
                            <li>Estimar L√≠neas de C√≥digo para 25+ lenguajes de programaci√≥n</li>
                            <li>Evaluar 14 caracter√≠sticas del sistema (GSC)</li>
                            <li>Obtener estimaciones de esfuerzo y complejidad</li>
                            <li>Acceder a definiciones t√©cnicas completas y ejemplos</li>
                            <li>Sistema de auto-guardado con protecci√≥n contra p√©rdida de datos</li>
                            <li>Interfaz moderna con indicadores de progreso en tiempo real</li>
                        </ul>
                    </div>
                    <button class="btn btn--primary btn--lg" onclick="startCalculation()">üöÄ Iniciar C√°lculo</button>
                    <button class="btn btn--secondary btn--lg" onclick="openHelpModal()" style="margin-left: 16px;">üìö Gu√≠a Completa</button>
                </div>
            </div>
        </section>

        <!-- CONFIGURACI√ìN DEL PROYECTO -->
        <section id="project-config" class="app-section hidden">
            <div class="container">
                <div class="progress-indicator">Paso 1 de 4: Configuraci√≥n del Proyecto</div>
                <h2 class="section-title">üõ†Ô∏è Configuraci√≥n del Proyecto 
                    <button class="btn btn--secondary" style="font-size: 12px; padding: 4px 8px; margin-left: 16px;" onclick="openHelpModal()">üìñ Ayuda Completa</button>
                </h2>
                
                <div class="card">
                    <div class="card__body">
                        <div class="form-group">
                            <label class="form-label" for="project-name">Nombre del Proyecto</label>
                            <input type="text" id="project-name" class="form-control" placeholder="Ingresa el nombre del proyecto">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="programming-language">Lenguaje de Programaci√≥n Principal 
                                <span class="tooltip"><span class="help-icon">?</span><span class="tooltip-text">El lenguaje principal determinar√° el factor de conversi√≥n de Puntos de Funci√≥n a L√≠neas de C√≥digo. Selecciona el lenguaje que representar√° la mayor parte del c√≥digo.</span></span>
                            </label>
                            <select id="programming-language" class="form-control">
                                <option value="">Selecciona un lenguaje de programaci√≥n</option>
                                <option value="C">C (128 LDC/PF)</option>
                                <option value="C++">C++ (53 LDC/PF)</option>
                                <option value="Java">Java (53 LDC/PF)</option>
                                <option value="C#">C# (53 LDC/PF)</option>
                                <option value="JavaScript">JavaScript (53 LDC/PF)</option>
                                <option value="Python">Python (53 LDC/PF)</option>
                                <option value="Visual Basic">Visual Basic (40 LDC/PF)</option>
                                <option value="PHP">PHP (53 LDC/PF)</option>
                                <option value="COBOL">COBOL (107 LDC/PF)</option>
                                <option value="SQL">SQL (13 LDC/PF)</option>
                                <option value="React">React (29 LDC/PF)</option>
                                <option value="Angular">Angular (29 LDC/PF)</option>
                                <option value="Vue">Vue (29 LDC/PF)</option>
                                <option value="Node.js">Node.js (53 LDC/PF)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="project-description">Descripci√≥n del Proyecto 
                                <span class="tooltip"><span class="help-icon">?</span><span class="tooltip-text">Describe el prop√≥sito, alcance y caracter√≠sticas principales del proyecto. Esta informaci√≥n ayudar√° en la evaluaci√≥n de las caracter√≠sticas del sistema.</span></span>
                            </label>
                            <textarea id="project-description" class="form-control" rows="3" placeholder="Ej: Sistema de gesti√≥n de inventarios con interfaz web, reportes autom√°ticos, integraci√≥n con proveedores y m√≥dulo de facturaci√≥n"></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="nav-buttons">
                    <button class="btn btn--secondary" onclick="goToHome()">Volver</button>
                    <button class="btn btn--primary" onclick="goToFunctions()">Siguiente</button>
                </div>
            </div>
        </section>

        <!-- FUNCIONES DEL SISTEMA -->
        <section id="functions-section" class="app-section hidden">
            <div class="container">
                <div class="progress-indicator">Paso 2 de 4: Funciones del Sistema</div>
                <h2 class="section-title">‚öôÔ∏è Funciones del Sistema</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('entradas')">Entradas</button>
                    <button class="tab" onclick="switchTab('salidas')">Salidas</button>
                    <button class="tab" onclick="switchTab('peticiones')">Peticiones</button>
                    <button class="tab" onclick="switchTab('archivos-internos')">Archivos Internos</button>
                    <button class="tab" onclick="switchTab('archivos-externos')">Archivos Externos</button>
                </div>

                <!-- Entradas Tab -->
                <div id="entradas-tab" class="tab-content active">
                    <div class="definition-box">
                        <h4>üì• Entradas (External Input - EI)</h4>
                        <p><strong>Definici√≥n:</strong> Transacciones relacionadas con agregar, eliminar (f√≠sica o l√≥gicamente) y modificar datos</p>
                        <p><strong>Ejemplos:</strong> Formulario de registro de usuario, Actualizaci√≥n de datos de producto, Eliminaci√≥n de cliente, Cambio de contrase√±a</p>
                        <div class="complexity-matrix">
                            <strong>Matriz de Complejidad:</strong><br>
                            ‚Ä¢ &lt;1-4 elementos datos, &lt;2 archivos: BAJO (3 PF)<br>
                            ‚Ä¢ 5-15 elementos datos, 2-3 archivos: MEDIO (4 PF)<br>
                            ‚Ä¢ &gt;15 elementos datos, &gt;3 archivos: ALTO (6 PF)
                        </div>
                    </div>
                    <table class="table" id="entradas-table">
                        <thead>
                            <tr>
                                <th>Nombre <span class="tooltip"><span class="help-icon">?</span><span class="tooltip-text">Nombre descriptivo de la funci√≥n que identifica claramente su prop√≥sito</span></span></th>
                                <th>Archivos Referidos <span class="tooltip"><span class="help-icon">?</span><span class="tooltip-text">N√∫mero de archivos internos (ILF) y archivos externos (EIF) que son accedidos, le√≠dos o actualizados por esta funci√≥n</span></span></th>
                                <th>Elementos de Datos <span class="tooltip"><span class="help-icon">?</span><span class="tooltip-text">Campos √∫nicos de informaci√≥n reconocidos por el usuario final que cruzan la frontera de la aplicaci√≥n</span></span></th>
                                <th>Nivel <span class="tooltip"><span class="help-icon">?</span><span class="tooltip-text">Clasificaci√≥n (Bajo, Medio, Alto) determinada por el n√∫mero de archivos referidos y elementos de datos</span></span></th>
                                <th>Valor PF <span class="tooltip"><span class="help-icon">?</span><span class="tooltip-text">Puntos de funci√≥n asignados a cada funci√≥n bas√°ndose en su tipo y nivel de complejidad</span></span></th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="entradas-tbody">
                        </tbody>
                    </table>
                    <button class="btn btn--secondary" onclick="addRow('entradas')">Agregar Entrada</button>
                    <div id="entradas-subtotal" class="result-value" style="margin-top: 16px;">Subtotal: 0 PF</div>
                </div>

                <!-- Salidas Tab -->
                <div id="salidas-tab" class="tab-content">
                    <div class="definition-box">
                        <h4>üìä Salidas (External Output - EO)</h4>
                        <p><strong>Definici√≥n:</strong> Consultas que involucran c√°lculos derivados (como c√°lculos matem√°ticos, estad√≠sticos o de resumen)</p>
                        <p><strong>Ejemplos:</strong> Reporte de ventas con totales, Gr√°fico de rendimiento, Balance contable, N√≥mina calculada</p>
                        <div class="complexity-matrix">
                            <strong>Matriz de Complejidad:</strong><br>
                            ‚Ä¢ &lt;1-5 elementos datos, &lt;2 archivos: BAJO (4 PF)<br>
                            ‚Ä¢ 6-19 elementos datos, 2-3 archivos: MEDIO (5 PF)<br>
                            ‚Ä¢ &gt;19 elementos datos, &gt;3 archivos: ALTO (7 PF)
                        </div>
                    </div>
                    <table class="table" id="salidas-table">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Archivos Referidos</th>
                                <th>Elementos de Datos</th>
                                <th>Nivel</th>
                                <th>Valor PF</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="salidas-tbody">
                        </tbody>
                    </table>
                    <button class="btn btn--secondary" onclick="addRow('salidas')">Agregar Salida</button>
                    <div id="salidas-subtotal" class="result-value" style="margin-top: 16px;">Subtotal: 0 PF</div>
                </div>

                <!-- Peticiones Tab -->
                <div id="peticiones-tab" class="tab-content">
                    <div class="definition-box">
                        <h4>üîç Peticiones (External Inquiry - EQ)</h4>
                        <p><strong>Definici√≥n:</strong> Consultas que no involucran c√°lculos derivados (como listados directos o b√∫squedas simples)</p>
                        <p><strong>Ejemplos:</strong> B√∫squeda de cliente por ID, Lista de productos, Consulta de inventario, Directorio telef√≥nico</p>
                        <div class="complexity-matrix">
                            <strong>Matriz de Complejidad:</strong><br>
                            ‚Ä¢ &lt;1-5 elementos datos, &lt;2 archivos: BAJO (3 PF)<br>
                            ‚Ä¢ 6-19 elementos datos, 2-3 archivos: MEDIO (4 PF)<br>
                            ‚Ä¢ &gt;19 elementos datos, &gt;3 archivos: ALTO (6 PF)
                        </div>
                    </div>
                    <table class="table" id="peticiones-table">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Archivos Referidos</th>
                                <th>Elementos de Datos</th>
                                <th>Nivel</th>
                                <th>Valor PF</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="peticiones-tbody">
                        </tbody>
                    </table>
                    <button class="btn btn--secondary" onclick="addRow('peticiones')">Agregar Petici√≥n</button>
                    <div id="peticiones-subtotal" class="result-value" style="margin-top: 16px;">Subtotal: 0 PF</div>
                </div>

                <!-- Archivos Internos Tab -->
                <div id="archivos-internos-tab" class="tab-content">
                    <div class="definition-box">
                        <h4>üóÇÔ∏è Archivos Internos (Internal Logical File - ILF)</h4>
                        <p><strong>Definici√≥n:</strong> Archivos l√≥gicos que son mantenidos (agregados, eliminados o modificados) por el propio sistema</p>
                        <p><strong>Ejemplos:</strong> Tabla de usuarios, Base de datos de productos, Archivo de configuraci√≥n del sistema, Log de transacciones</p>
                        <div class="complexity-matrix">
                            <strong>Matriz de Complejidad:</strong><br>
                            ‚Ä¢ &lt;2 registros, &lt;20 elementos: BAJO (7 PF)<br>
                            ‚Ä¢ 2-5 registros, 20-50 elementos: MEDIO (10 PF)<br>
                            ‚Ä¢ &gt;5 registros, &gt;50 elementos: ALTO (15 PF)
                        </div>
                    </div>
                    <table class="table" id="archivos-internos-table">
                        <thead>
                            <tr>
                                <th>Nombre <span class="tooltip"><span class="help-icon">?</span><span class="tooltip-text">Nombre descriptivo del archivo l√≥gico</span></span></th>
                                <th>Elementos de Registro <span class="tooltip"><span class="help-icon">?</span><span class="tooltip-text">Subgrupos opcionales de elementos de datos dentro del archivo (ej: tipos de empleado, categor√≠as de producto)</span></span></th>
                                <th>Elementos de Datos <span class="tooltip"><span class="help-icon">?</span><span class="tooltip-text">Campos √∫nicos de informaci√≥n mantenidos en el archivo</span></span></th>
                                <th>Nivel <span class="tooltip"><span class="help-icon">?</span><span class="tooltip-text">Clasificaci√≥n basada en elementos de registro y datos</span></span></th>
                                <th>Valor PF <span class="tooltip"><span class="help-icon">?</span><span class="tooltip-text">Puntos de funci√≥n asignados seg√∫n la complejidad</span></span></th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="archivos-internos-tbody">
                        </tbody>
                    </table>
                    <button class="btn btn--secondary" onclick="addRow('archivos-internos')">Agregar Archivo Interno</button>
                    <div id="archivos-internos-subtotal" class="result-value" style="margin-top: 16px;">Subtotal: 0 PF</div>
                </div>

                <!-- Archivos Externos Tab -->
                <div id="archivos-externos-tab" class="tab-content">
                    <div class="definition-box">
                        <h4>üìÅ Archivos Externos (External Interface File - EIF)</h4>
                        <p><strong>Definici√≥n:</strong> Archivos l√≥gicos que son referenciados por el sistema pero mantenidos por otro sistema externo</p>
                        <p><strong>Ejemplos:</strong> API externa de pagos, Base de datos de c√≥digos postales, Cat√°logo de productos del proveedor, Servicios web de terceros</p>
                        <div class="complexity-matrix">
                            <strong>Matriz de Complejidad:</strong><br>
                            ‚Ä¢ &lt;2 registros, &lt;20 elementos: BAJO (5 PF)<br>
                            ‚Ä¢ 2-5 registros, 20-50 elementos: MEDIO (7 PF)<br>
                            ‚Ä¢ &gt;5 registros, &gt;50 elementos: ALTO (10 PF)
                        </div>
                    </div>
                    <table class="table" id="archivos-externos-table">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Elementos de Registro</th>
                                <th>Elementos de Datos</th>
                                <th>Nivel</th>
                                <th>Valor PF</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="archivos-externos-tbody">
                        </tbody>
                    </table>
                    <button class="btn btn--secondary" onclick="addRow('archivos-externos')">Agregar Archivo Externo</button>
                    <div id="archivos-externos-subtotal" class="result-value" style="margin-top: 16px;">Subtotal: 0 PF</div>
                </div>
                
                <div class="breadcrumb">
                    <div class="breadcrumb-item">
                        <span>üìù</span> Configuraci√≥n
                    </div>
                    <div class="breadcrumb-separator">‚Üí</div>
                    <div class="breadcrumb-item active">
                        <span>‚öôÔ∏è</span> Funciones
                    </div>
                    <div class="breadcrumb-separator">‚Üí</div>
                    <div class="breadcrumb-item">
                        <span>üèõÔ∏è</span> Caracter√≠sticas
                    </div>
                    <div class="breadcrumb-separator">‚Üí</div>
                    <div class="breadcrumb-item">
                        <span>üìà</span> Resultados
                    </div>
                </div>
                
                <div class="nav-buttons">
                    <button class="btn btn--secondary" onclick="goToProjectConfig()">‚Üê Anterior: Configuraci√≥n</button>
                    <button class="btn btn--primary" onclick="goToCharacteristics()">Siguiente: Caracter√≠sticas ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- CARACTER√çSTICAS DEL SISTEMA -->
        <section id="characteristics-section" class="app-section hidden">
            <div class="container">
                <div class="progress-indicator">Paso 3 de 4: Caracter√≠sticas del Sistema</div>
                <h2 class="section-title">üéõÔ∏è Caracter√≠sticas del Sistema (GSC)</h2>
                <p class="help-text">Eval√∫a cada caracter√≠stica del sistema en una escala de 0 a 5</p>
                
                <div id="gsc-container">
                    <!-- GSC items will be generated here -->
                </div>
                
                <div class="breadcrumb">
                    <div class="breadcrumb-item">
                        <span>üìù</span> Configuraci√≥n
                    </div>
                    <div class="breadcrumb-separator">‚Üí</div>
                    <div class="breadcrumb-item">
                        <span>‚öôÔ∏è</span> Funciones
                    </div>
                    <div class="breadcrumb-separator">‚Üí</div>
                    <div class="breadcrumb-item active">
                        <span>üèõÔ∏è</span> Caracter√≠sticas
                    </div>
                    <div class="breadcrumb-separator">‚Üí</div>
                    <div class="breadcrumb-item">
                        <span>üìà</span> Resultados
                    </div>
                </div>
                
                <div class="nav-buttons">
                    <button class="btn btn--secondary" onclick="goToFunctions()">‚Üê Anterior: Funciones</button>
                    <button class="btn btn--primary" onclick="goToResults()">Finalizar: Ver Resultados ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- RESULTADOS -->
        <section id="results-section" class="app-section hidden">
            <div class="container">
                <div class="progress-indicator">Paso 4 de 4: Resultados</div>
                <h2 class="section-title">üìà Resultados del C√°lculo</h2>
                
                <div class="results-grid">
                    <div class="result-card" style="border-left: 4px solid var(--color-info);">
                        <h4>üìä Puntos de Funci√≥n No Ajustados</h4>
                        <div id="unadjusted-fp" class="result-value">0</div>
                        <p class="help-text">Suma de todas las funciones sin ajustar</p>
                    </div>
                    <div class="result-card" style="border-left: 4px solid var(--color-warning);">
                        <h4>‚öñÔ∏è Factor de Ajuste de Valor</h4>
                        <div id="vaf" class="result-value">1.00</div>
                        <p class="help-text">Basado en caracter√≠sticas del sistema (GSC)</p>
                    </div>
                    <div class="result-card" style="border-left: 4px solid var(--color-success);">
                        <h4>üéØ Puntos de Funci√≥n Ajustados</h4>
                        <div id="adjusted-fp" class="result-value">0</div>
                        <p class="help-text">M√©trica final de tama√±o funcional</p>
                    </div>
                    <div class="result-card" style="border-left: 4px solid var(--color-primary);">
                        <h4>üíª L√≠neas de C√≥digo Estimadas</h4>
                        <div id="lines-of-code" class="result-value">0</div>
                        <p class="help-text">Estimaci√≥n para <span id="selected-language">el lenguaje seleccionado</span></p>
                    </div>
                </div>

                <div class="card">
                    <div class="card__body">
                        <h3>Resumen del Proyecto</h3>
                        <div id="project-summary"></div>
                    </div>
                </div>
                
                <div class="nav-buttons">
                    <button class="btn btn--secondary" onclick="goToCharacteristics()">‚¨ÖÔ∏è Anterior</button>
                    <button class="btn btn--primary" onclick="exportToCSV()" style="background: #28a745; color: white;">üìä Exportar a CSV (Excel)</button>
                    <button class="btn btn--secondary" onclick="printResults()">üñ®Ô∏è Imprimir</button>
                    <button class="btn btn--secondary" onclick="resetProject()">üîÑ Nuevo Proyecto</button>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Data from JSON
        const languageFactors = {
            'C': 128, 'C++': 53, 'Java': 53, 'C#': 53, 'JavaScript': 53,
            'Python': 53, 'Visual Basic': 40, 'PHP': 53, 'COBOL': 107,
            'SQL': 13, 'React': 29, 'Angular': 29, 'Vue': 29, 'Node.js': 53
        };

        const functionPointValues = {
            'entradas': { 'Bajo': 3, 'Medio': 4, 'Alto': 6 },
            'salidas': { 'Bajo': 4, 'Medio': 5, 'Alto': 7 },
            'peticiones': { 'Bajo': 3, 'Medio': 4, 'Alto': 6 },
            'archivos-internos': { 'Bajo': 7, 'Medio': 10, 'Alto': 15 },
            'archivos-externos': { 'Bajo': 5, 'Medio': 7, 'Alto': 10 }
        };

        const gscCharacteristics = [
            { id: 1, name: "Comunicaciones de Datos", question: "¬øC√≥mo transfiere datos el sistema?", description: "Eval√∫a las necesidades de comunicaci√≥n del sistema para transferir informaci√≥n entre componentes", example: "Un sistema bancario que procesa transacciones en tiempo real" },
            { id: 2, name: "Procesamiento Distribuido", question: "¬øEl sistema distribuye el procesamiento entre m√∫ltiples componentes?", description: "Mide c√≥mo el sistema distribuye tareas y datos entre diferentes componentes o servidores", example: "Un motor de b√∫squeda que distribuye consultas entre m√∫ltiples servidores" },
            { id: 3, name: "Requisitos de Rendimiento", question: "¬øQu√© tan cr√≠ticos son los tiempos de respuesta del sistema?", description: "Eval√∫a la importancia del rendimiento y velocidad de respuesta del sistema", example: "Sistema de control de tr√°fico a√©reo que requiere respuestas instant√°neas" },
            { id: 4, name: "Uso Intensivo del Hardware", question: "¬øEl sistema funcionar√° en un ambiente con recursos limitados?", description: "Eval√∫a si el sistema debe funcionar eficientemente en hardware con alta demanda", example: "Sistema universitario de inscripciones usado por miles de estudiantes simult√°neamente" },
            { id: 5, name: "Volumen de Transacciones", question: "¬øEl sistema debe manejar grandes vol√∫menes de transacciones?", description: "Mide la frecuencia e intensidad de las operaciones que debe procesar el sistema", example: "Sistema bancario que procesa millones de transacciones nocturnas" },
            { id: 6, name: "Entrada de Datos Interactiva", question: "¬øQu√© porcentaje de datos se captura de forma interactiva?", description: "Eval√∫a cu√°nta informaci√≥n ingresa el usuario directamente vs. procesamiento autom√°tico", example: "Sistema de inventario donde operadores escanean productos manualmente" },
            { id: 7, name: "Facilidad de Uso", question: "¬øEl sistema est√° dise√±ado para ser f√°cil y eficiente de usar?", description: "Eval√∫a las caracter√≠sticas que mejoran la experiencia del usuario final", example: "Software de an√°lisis financiero con interfaz intuitiva para ejecutivos" },
            { id: 8, name: "Actualizaciones en Tiempo Real", question: "¬øCu√°ntos archivos principales actualiza el sistema en tiempo real?", description: "Mide la complejidad de mantener datos actualizados instant√°neamente", example: "Sistema de reservas a√©reas que bloquea asientos en tiempo real" },
            { id: 9, name: "Complejidad de Procesamiento", question: "¬øEl sistema realiza c√°lculos complejos o toma decisiones elaboradas?", description: "Eval√∫a la complejidad del procesamiento interno del sistema", example: "Sistema de diagn√≥stico m√©dico con algoritmos de inteligencia artificial" },
            { id: 10, name: "Reutilizaci√≥n de C√≥digo", question: "¬øEl sistema est√° dise√±ado para reutilizar componentes?", description: "Eval√∫a si el c√≥digo puede usarse en m√∫ltiples sistemas o por diferentes usuarios", example: "Biblioteca de componentes de interfaz usada en m√∫ltiples aplicaciones" },
            { id: 11, name: "Facilidad de Instalaci√≥n", question: "¬øQu√© tan f√°cil es instalar y configurar el sistema?", description: "Eval√∫a la complejidad del proceso de instalaci√≥n y migraci√≥n", example: "Software empresarial con instalador autom√°tico y migraci√≥n de datos" },
            { id: 12, name: "Facilidad de Operaci√≥n", question: "¬øQu√© tan automatizadas son las operaciones diarias del sistema?", description: "Eval√∫a el nivel de automatizaci√≥n en respaldos, recuperaci√≥n y mantenimiento", example: "Sistema de base de datos con respaldo autom√°tico y recuperaci√≥n de desastres" },
            { id: 13, name: "M√∫ltiples Ubicaciones", question: "¬øEl sistema funcionar√° en diferentes lugares u organizaciones?", description: "Eval√∫a si el sistema debe adaptarse a diferentes entornos e instalaciones", example: "Software de una multinacional usado en oficinas de diferentes pa√≠ses" },
            { id: 14, name: "Facilidad de Mantenimiento", question: "¬øEl sistema est√° dise√±ado para facilitar cambios futuros?", description: "Eval√∫a qu√© tan f√°cil ser√° modificar y mantener el sistema en el futuro", example: "Sistema ERP con configuraci√≥n flexible sin necesidad de reprogramar" }
        ];

        // Project data with auto-save functionality
        let projectData = {
            name: '',
            language: '',
            description: '',
            functions: {
                entradas: [],
                salidas: [],
                peticiones: [],
                'archivos-internos': [],
                'archivos-externos': []
            },
            gscValues: Array(14).fill(0)
        };
        
        // Auto-save and recovery system (using in-memory storage)
        let isDataChanged = false;
        let lastSaveTime = null;
        let autoSaveInterval = null;
        let savedProjectData = null; // In-memory storage replacement
        
        // Auto-save functionality (in-memory)
        function autoSave() {
            try {
                savedProjectData = {
                    ...JSON.parse(JSON.stringify(projectData)), // Deep copy
                    timestamp: Date.now(),
                    lastModified: new Date().toLocaleString('es-ES')
                };
                lastSaveTime = Date.now();
                isDataChanged = false;
                updateSaveStatus('‚úÖ Guardado', 'var(--color-success)');
            } catch (error) {
                console.warn('Error en auto-save:', error);
                updateSaveStatus('‚ùå Error al guardar', 'var(--color-error)');
            }
        }
        
        function manualSave() {
            updateSaveStatus('‚è≥ Guardando...', 'var(--color-warning)');
            setTimeout(() => {
                autoSave();
                showSaveMessage('üíæ Progreso guardado en memoria');
            }, 500);
        }
        
        function updateSaveStatus(status, color) {
            const statusElement = document.getElementById('save-status');
            if (statusElement) {
                statusElement.textContent = status;
                statusElement.style.color = color;
            }
        }
        
        function showSaveMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.innerHTML = message;
            messageDiv.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: var(--color-success);
                color: white;
                padding: 12px 16px;
                border-radius: 6px;
                box-shadow: var(--shadow-lg);
                z-index: 2000;
                font-weight: 500;
                animation: slideInRight 0.3s ease-out;
            `;
            
            document.body.appendChild(messageDiv);
            setTimeout(() => {
                messageDiv.style.opacity = '0';
                messageDiv.style.transform = 'translateX(100%)';
                messageDiv.style.transition = 'all 0.3s';
                setTimeout(() => messageDiv.remove(), 300);
            }, 2000);
        }
        
        // Load saved data (from memory)
        function loadSavedData() {
            return savedProjectData; // Return in-memory saved data
        }
        
        // Check for unsaved changes
        function markDataAsChanged() {
            isDataChanged = true;
            updateSaveStatus('‚ö†Ô∏è Sin guardar', 'var(--color-warning)');
        }
        
        // Recovery modal
        function showRecoveryModal(savedData) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 3000;
                display: flex;
                justify-content: center;
                align-items: center;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: var(--color-surface);
                padding: 32px;
                border-radius: 12px;
                max-width: 500px;
                width: 90%;
                text-align: center;
                box-shadow: var(--shadow-lg);
            `;
            
            modalContent.innerHTML = `
                <h3 style="color: var(--color-primary); margin: 0 0 16px 0;">üîÑ Trabajo Previo Encontrado</h3>
                <p style="margin: 16px 0;">Se encontr√≥ un proyecto guardado previamente.</p>
                <div style="background: var(--color-bg-1); padding: 16px; border-radius: 8px; margin: 16px 0; text-align: left;">
                    <strong>Proyecto:</strong> ${savedData.name || 'Sin nombre'}<br>
                    <strong>Lenguaje:</strong> ${savedData.language || 'No seleccionado'}<br>
                    <strong>√öltima modificaci√≥n:</strong> ${savedData.lastModified}<br>
                </div>
                <p style="margin: 16px 0; color: var(--color-text-secondary);"><strong>¬øDeseas recuperar tu trabajo previo?</strong></p>
                <div style="display: flex; gap: 12px; justify-content: center; margin-top: 24px;">
                    <button id="recover-btn" class="btn btn--primary">üîÑ Continuar donde qued√©</button>
                    <button id="new-btn" class="btn btn--secondary">üÜï Empezar nuevo proyecto</button>
                </div>
            `;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            document.getElementById('recover-btn').onclick = () => {
                recoverData(savedData);
                modal.remove();
            };
            
            document.getElementById('new-btn').onclick = () => {
                savedProjectData = null; // Clear in-memory data
                modal.remove();
                showSaveMessage('üÜï Nuevo proyecto iniciado');
            };
        }
        
        function recoverData(savedData) {
            projectData = { ...savedData };
            
            // Restore form data
            if (projectData.name) document.getElementById('project-name').value = projectData.name;
            if (projectData.language) document.getElementById('programming-language').value = projectData.language;
            if (projectData.description) document.getElementById('project-description').value = projectData.description;
            
            // Restore function tables
            Object.keys(projectData.functions).forEach(type => {
                const tbody = document.getElementById(type + '-tbody');
                if (tbody) tbody.innerHTML = '';
                
                projectData.functions[type].forEach(func => {
                    addRowWithData(type, func);
                });
            });
            
            showSaveMessage('‚úÖ Trabajo previo recuperado exitosamente');
            updateSaveStatus('‚úÖ Guardado', 'var(--color-success)');
        }

        // Navigation functions
        function startCalculation() {
            showSection('project-config');
        }

        function goToHome() {
            showSection('home-section');
        }

        function goToProjectConfig() {
            showSection('project-config');
        }

        function goToFunctions() {
            // Save project config
            projectData.name = document.getElementById('project-name').value;
            projectData.language = document.getElementById('programming-language').value;
            projectData.description = document.getElementById('project-description').value;
            
            // Validation
            if (!projectData.name.trim()) {
                alert('‚ö†Ô∏è Por favor ingresa un nombre para el proyecto');
                return;
            }
            
            if (!projectData.language) {
                alert('‚ö†Ô∏è Por favor selecciona un lenguaje de programaci√≥n');
                return;
            }
            
            // Generate function progress indicator
            addFunctionProgressIndicator();
            
            markDataAsChanged();
            showSection('functions-section');
        }
        
        function addFunctionProgressIndicator() {
            const sections = ['functions-section', 'characteristics-section', 'results-section'];
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                const existing = section.querySelector('.section-progress');
                if (existing) existing.remove();
                
                if (sectionId === 'functions-section') {
                    const progressDiv = document.createElement('div');
                    progressDiv.className = 'section-progress';
                    progressDiv.innerHTML = `
                        <div style="background: var(--color-bg-1); padding: 16px; border-radius: 8px; margin-bottom: 24px;">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h4 style="margin: 0; color: var(--color-primary);">Progreso de Funciones</h4>
                                    <p style="margin: 4px 0 0 0; font-size: 14px;"><span id="functions-completed">0</span> funciones definidas</p>
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <button class="btn btn--primary" style="font-size: 12px; padding: 6px 12px;" onclick="manualSave()">üíæ Guardar</button>
                                    <div id="functions-total-display" style="background: var(--color-primary); padding: 8px 16px; border-radius: 16px; color: white; font-weight: 600;">0 PF</div>
                                </div>
                            </div>
                        </div>
                    `;
                    const container = section.querySelector('.container');
                    const progressIndicator = container.querySelector('.progress-indicator');
                    progressIndicator.after(progressDiv);
                }
            });
        }
        
        function updateFunctionProgress() {
            const totalFunctions = Object.values(projectData.functions).reduce((sum, arr) => sum + arr.length, 0);
            const totalFP = Object.values(projectData.functions).reduce((sum, functions) => 
                sum + functions.reduce((subSum, func) => subSum + func.fpValue, 0), 0
            );
            
            const completedElement = document.getElementById('functions-completed');
            const totalDisplay = document.getElementById('functions-total-display');
            
            if (completedElement) completedElement.textContent = totalFunctions;
            if (totalDisplay) totalDisplay.textContent = `${totalFP} PF`;
        }

        function goToCharacteristics() {
            generateGSCForm();
            updateGSCTotals(); // Initialize GSC totals display
            showSection('characteristics-section');
        }

        function goToResults() {
            // Save GSC values
            for (let i = 0; i < 14; i++) {
                const value = document.querySelector(`input[name="gsc-${i+1}"]:checked`);
                projectData.gscValues[i] = value ? parseInt(value.value) : 0;
            }
            
            calculateResults();
            showSection('results-section');
        }

        function showSection(sectionId) {
            const sections = ['home-section', 'project-config', 'functions-section', 'characteristics-section', 'results-section'];
            sections.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
        }

        // Tab switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // Table management
        function addRow(functionType) {
            const tbody = document.getElementById(functionType + '-tbody');
            const row = document.createElement('tr');
            const rowId = Date.now(); // Simple ID generation
            
            let columnsHtml;
            if (functionType.includes('archivos')) {
                columnsHtml = `
                    <td><input type="text" placeholder="Ej: Tabla Usuarios" onchange="updateRow('${functionType}', ${rowId})"></td>
                    <td><input type="number" min="0" placeholder="1-10" onchange="updateRow('${functionType}', ${rowId})" title="Subgrupos opcionales de datos"></td>
                    <td><input type="number" min="0" placeholder="10-50" onchange="updateRow('${functionType}', ${rowId})" title="Campos mantenidos en el archivo">
                    <td><span class="complexity-level">-</span></td>
                    <td><span class="fp-value">0</span></td>
                    <td><button class="btn btn--secondary" onclick="removeRow('${functionType}', ${rowId})">Eliminar</button></td>
                `;
            } else {
                columnsHtml = `
                    <td><input type="text" placeholder="Ej: Registro de usuario" onchange="updateRow('${functionType}', ${rowId})"></td>
                    <td><input type="number" min="0" placeholder="1-5" onchange="updateRow('${functionType}', ${rowId})" title="N√∫mero de ILF + EIF accedidos"></td>
                    <td><input type="number" min="0" placeholder="5-20" onchange="updateRow('${functionType}', ${rowId})" title="Campos de informaci√≥n √∫nicos">
                    <td><span class="complexity-level">-</span></td>
                    <td><span class="fp-value">0</span></td>
                    <td><button class="btn btn--secondary" onclick="removeRow('${functionType}', ${rowId})">Eliminar</button></td>
                `;
            }
            
            row.innerHTML = columnsHtml;
            row.dataset.rowId = rowId;
            tbody.appendChild(row);
            
            // Initialize empty data
            if (!projectData.functions[functionType]) {
                projectData.functions[functionType] = [];
            }
            projectData.functions[functionType].push({
                id: rowId,
                name: '',
                files: 0,
                elements: 0,
                complexity: 'Bajo',
                fpValue: 0
            });
            
            markDataAsChanged();
        }
        
        function addRowWithData(functionType, functionData) {
            const tbody = document.getElementById(functionType + '-tbody');
            const row = document.createElement('tr');
            
            let columnsHtml;
            if (functionType.includes('archivos')) {
                columnsHtml = `
                    <td><input type="text" value="${functionData.name || ''}" placeholder="Ej: Tabla Usuarios" onchange="updateRow('${functionType}', ${functionData.id})"></td>
                    <td><input type="number" value="${functionData.files || ''}" min="0" placeholder="1-10" onchange="updateRow('${functionType}', ${functionData.id})" title="Subgrupos opcionales de datos"></td>
                    <td><input type="number" value="${functionData.elements || ''}" min="0" placeholder="10-50" onchange="updateRow('${functionType}', ${functionData.id})" title="Campos mantenidos en el archivo">
                    <td><span class="complexity-level">${functionData.complexity || 'Bajo'}</span></td>
                    <td><span class="fp-value">${functionData.fpValue || 0}</span></td>
                    <td><button class="btn btn--secondary" onclick="removeRow('${functionType}', ${functionData.id})">Eliminar</button></td>
                `;
            } else {
                columnsHtml = `
                    <td><input type="text" value="${functionData.name || ''}" placeholder="Ej: Registro de usuario" onchange="updateRow('${functionType}', ${functionData.id})"></td>
                    <td><input type="number" value="${functionData.files || ''}" min="0" placeholder="1-5" onchange="updateRow('${functionType}', ${functionData.id})" title="N√∫mero de ILF + EIF accedidos"></td>
                    <td><input type="number" value="${functionData.elements || ''}" min="0" placeholder="5-20" onchange="updateRow('${functionType}', ${functionData.id})" title="Campos de informaci√≥n √∫nicos">
                    <td><span class="complexity-level">${functionData.complexity || 'Bajo'}</span></td>
                    <td><span class="fp-value">${functionData.fpValue || 0}</span></td>
                    <td><button class="btn btn--secondary" onclick="removeRow('${functionType}', ${functionData.id})">Eliminar</button></td>
                `;
            }
            
            row.innerHTML = columnsHtml;
            row.dataset.rowId = functionData.id;
            tbody.appendChild(row);
            
            updateSubtotal(functionType);
        }

        function updateRow(functionType, rowId) {
            const row = document.querySelector(`[data-row-id="${rowId}"]`);
            const inputs = row.querySelectorAll('input');
            
            const functionData = projectData.functions[functionType].find(f => f.id === rowId);
            if (!functionData) return;
            
            functionData.name = inputs[0].value;
            functionData.files = parseInt(inputs[1].value) || 0;
            functionData.elements = parseInt(inputs[2].value) || 0;
            
            // Calculate complexity
            const complexity = calculateComplexity(functionType, functionData.files, functionData.elements);
            functionData.complexity = complexity;
            functionData.fpValue = functionPointValues[functionType][complexity];
            
            // Update UI
            row.querySelector('.complexity-level').textContent = complexity;
            row.querySelector('.fp-value').textContent = functionData.fpValue;
            
            updateSubtotal(functionType);
            markDataAsChanged();
        }

        function removeRow(functionType, rowId) {
            const row = document.querySelector(`[data-row-id="${rowId}"]`);
            row.remove();
            
            projectData.functions[functionType] = projectData.functions[functionType].filter(f => f.id !== rowId);
            updateSubtotal(functionType);
            markDataAsChanged();
        }

        function calculateComplexity(functionType, files, elements) {
            if (functionType.includes('archivos')) {
                // Use files as registro_elem and elements as datos
                if (files < 2) {
                    if (elements <= 19) return 'Bajo';
                    if (elements <= 50) return 'Bajo';
                    return 'Medio';
                } else if (files <= 5) {
                    if (elements <= 19) return 'Bajo';
                    if (elements <= 50) return 'Medio';
                    return 'Alto';
                } else {
                    if (elements <= 19) return 'Medio';
                    if (elements <= 50) return 'Alto';
                    return 'Alto';
                }
            } else {
                // For entradas, salidas, peticiones
                if (functionType === 'entradas') {
                    if (files < 2) {
                        if (elements <= 4) return 'Bajo';
                        if (elements <= 15) return 'Bajo';
                        return 'Medio';
                    } else if (files === 2) {
                        if (elements <= 4) return 'Bajo';
                        if (elements <= 15) return 'Medio';
                        return 'Alto';
                    } else {
                        if (elements <= 4) return 'Medio';
                        if (elements <= 15) return 'Alto';
                        return 'Alto';
                    }
                } else {
                    // salidas and peticiones
                    if (files < 2) {
                        if (elements <= 5) return 'Bajo';
                        if (elements <= 19) return 'Bajo';
                        return 'Medio';
                    } else if (files <= 3) {
                        if (elements <= 5) return 'Bajo';
                        if (elements <= 19) return 'Medio';
                        return 'Alto';
                    } else {
                        if (elements <= 5) return 'Medio';
                        if (elements <= 19) return 'Alto';
                        return 'Alto';
                    }
                }
            }
        }

        function updateSubtotal(functionType) {
            const total = projectData.functions[functionType].reduce((sum, func) => sum + func.fpValue, 0);
            const subtotalElement = document.getElementById(functionType + '-subtotal');
            if (subtotalElement) {
                subtotalElement.textContent = `Subtotal: ${total} PF`;
                
                // Add visual feedback
                if (total > 0) {
                    subtotalElement.style.color = 'var(--color-success)';
                    subtotalElement.style.fontWeight = '600';
                } else {
                    subtotalElement.style.color = 'var(--color-text-secondary)';
                    subtotalElement.style.fontWeight = '400';
                }
            }
            
            // Update overall function progress
            updateFunctionProgress();
        }

        // GSC detailed criteria data - NUEVAS PREGUNTAS REDISE√ëADAS
        const gscDetailedCriteria = {
            "1. Comunicaciones de Datos": {
                "0": "Aplicaci√≥n independiente sin comunicaci√≥n externa (ej: calculadora offline)",
                "1": "Sistema por lotes con entrada o salida remota b√°sica",
                "2": "Sistema por lotes con entrada Y salida remota",
                "3": "Sistema web b√°sico con interfaz online para procesos",
                "4": "Sistema interactivo con un protocolo de comunicaci√≥n (ej: API REST)",
                "5": "Sistema complejo con m√∫ltiples protocolos (REST, GraphQL, WebSockets, etc.)"
            },
            "2. Procesamiento Distribuido": {
                "0": "Todo el procesamiento ocurre en un solo lugar",
                "1": "Prepara datos para que otro sistema los procese",
                "2": "Env√≠a datos a otro sistema para procesamiento autom√°tico",
                "3": "Procesamiento distribuido en tiempo real en una direcci√≥n",
                "4": "Procesamiento distribuido bidireccional en tiempo real",
                "5": "Procesamiento din√°mico que elige autom√°ticamente el mejor servidor"
            },
            "3. Requisitos de Rendimiento": {
                "0": "No hay requisitos especiales de velocidad",
                "1": "Rendimiento considerado pero sin medidas espec√≠ficas",
                "2": "Velocidad cr√≠tica en horas pico (ej: Black Friday)",
                "3": "Velocidad cr√≠tica durante horario laboral completo",
                "4": "Requiere an√°lisis de rendimiento durante el dise√±o",
                "5": "Usa herramientas especializadas para optimizar rendimiento"
            },
            "4. Uso Intensivo del Hardware": {
                "0": "Hardware dedicado sin otras aplicaciones importantes",
                "1": "Comparte recursos pero con restricciones m√≠nimas",
                "2": "Debe considerar seguridad y tiempo de procesamiento",
                "3": "Requiere optimizaciones espec√≠ficas para el procesador",
                "4": "Necesita optimizaciones especiales para el servidor principal",
                "5": "Requiere optimizaciones en toda la infraestructura distribuida"
            },
            "5. Volumen de Transacciones": {
                "0": "Pocas transacciones, sin picos de uso",
                "1": "Picos de uso ocasionales (mensual/estacional)",
                "2": "Picos de uso semanales",
                "3": "Picos de uso diarios",
                "4": "Alto volumen requiere an√°lisis de capacidad",
                "5": "Volumen extremo requiere herramientas especializadas y an√°lisis continuo"
            },
            "6. Entrada de Datos Interactiva": {
                "0": "Todas las transacciones son autom√°ticas (0%)",
                "1": "1-7% de las funciones requieren entrada manual",
                "2": "8-15% de las funciones requieren entrada manual",
                "3": "16-23% de las funciones requieren entrada manual",
                "4": "24-30% de las funciones requieren entrada manual",
                "5": "M√°s del 30% requiere entrada manual constante"
            },
            "7. Facilidad de Uso": {
                "0": "Interfaz b√°sica sin caracter√≠sticas especiales",
                "1": "1-3 caracter√≠sticas de usabilidad (men√∫s, ayuda b√°sica)",
                "2": "4-5 caracter√≠sticas de usabilidad (navegaci√≥n, atajos)",
                "3": "6+ caracter√≠sticas pero sin requisitos espec√≠ficos",
                "4": "6+ caracter√≠sticas con estudios de usabilidad",
                "5": "Dise√±o avanzado con pruebas especializadas de usuario"
            },
            "8. Actualizaciones en Tiempo Real": {
                "0": "No actualiza archivos en tiempo real",
                "1": "Actualiza 1-3 archivos simples con f√°cil recuperaci√≥n",
                "2": "Actualiza 4+ archivos simples con f√°cil recuperaci√≥n",
                "3": "Actualiza archivos principales del sistema",
                "4": "Incluye protecci√≥n cr√≠tica contra p√©rdida de datos",
                "5": "Sistema automatizado de recuperaci√≥n para alto volumen"
            },
            "9. Complejidad de Procesamiento": {
                "0": "Procesamiento simple sin c√°lculos complejos",
                "1": "Una caracter√≠stica: l√≥gica extensa O matem√°ticas O multimedia O excepciones O seguridad",
                "2": "Dos de las caracter√≠sticas anteriores",
                "3": "Tres de las caracter√≠sticas anteriores",
                "4": "Cuatro de las caracter√≠sticas anteriores",
                "5": "Todas las caracter√≠sticas: l√≥gica + matem√°ticas + multimedia + excepciones + seguridad"
            },
            "10. Reutilizaci√≥n de C√≥digo": {
                "0": "C√≥digo espec√≠fico, no reutilizable",
                "1": "Reutiliza c√≥digo dentro de la misma aplicaci√≥n",
                "2": "Menos del 10% es reutilizable por otros sistemas",
                "3": "10% o m√°s es reutilizable por otros sistemas",
                "4": "Espec√≠ficamente documentado para reutilizaci√≥n (requiere modificar c√≥digo)",
                "5": "Completamente configurable para reutilizaci√≥n (sin modificar c√≥digo)"
            },
            "11. Facilidad de Instalaci√≥n": {
                "0": "Instalaci√≥n simple sin consideraciones especiales",
                "1": "Instalaci√≥n simple pero requiere configuraci√≥n espec√≠fica",
                "2": "Incluye gu√≠as de instalaci√≥n probadas (impacto menor)",
                "3": "Incluye gu√≠as de instalaci√≥n probadas (impacto significativo)",
                "4": "Proporciona herramientas automatizadas (impacto menor)",
                "5": "Proporciona herramientas automatizadas (impacto significativo)"
            },
            "12. Facilidad de Operaci√≥n": {
                "0": "Operaci√≥n manual b√°sica, solo respaldos normales",
                "1": "Procedimientos de respaldo automatizados",
                "2": "Respaldo + recuperaci√≥n automatizados",
                "3": "Minimiza intervenci√≥n manual (montaje cintas, papeles)",
                "4": "Operaci√≥n semi-automatizada con m√≠nima supervisi√≥n",
                "5": "Operaci√≥n completamente automatizada con auto-recuperaci√≥n"
            },
            "13. M√∫ltiples Ubicaciones": {
                "0": "Un solo sitio de instalaci√≥n",
                "1": "M√∫ltiples sitios con configuraci√≥n id√©ntica",
                "2": "M√∫ltiples sitios con configuraci√≥n similar",
                "3": "M√∫ltiples sitios con configuraciones diferentes",
                "4": "Incluye documentaci√≥n y soporte para m√∫ltiples sitios (config. similar)",
                "5": "Incluye documentaci√≥n y soporte para m√∫ltiples sitios (config. diferente)"
            },
            "14. Facilidad de Mantenimiento": {
                "0": "Sin consideraciones especiales para cambios",
                "1": "Permite consultas y reportes flexibles simples",
                "2": "Permite modificaciones de complejidad media",
                "3": "Permite modificaciones complejas",
                "4": "Datos de configuraci√≥n en tablas editables (actualizaci√≥n diferida)",
                "5": "Datos de configuraci√≥n en tablas editables (actualizaci√≥n inmediata)"
            }
        };

        // GSC Form Generation
        function generateGSCForm() {
            const container = document.getElementById('gsc-container');
            container.innerHTML = '';
            
            // A√±adir indicador de progreso GSC
            const progressDiv = document.createElement('div');
            progressDiv.innerHTML = `
                <div class="gsc-progress" style="margin-bottom: 24px; padding: 16px; background: var(--color-bg-3); border-radius: 8px;">
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 style="margin: 0; color: var(--color-success);">Progreso GSC</h4>
                            <p style="margin: 4px 0 0 0; font-size: 14px;"><span id="gsc-completed">0</span>/14 caracter√≠sticas evaluadas</p>
                        </div>
                        <div style="background: var(--color-success); padding: 8px 16px; border-radius: 16px; color: white; font-weight: 600;" id="gsc-total-display">GSC: 0</div>
                    </div>
                    <div style="width: 100%; background: var(--color-border); height: 8px; border-radius: 4px; margin-top: 12px; overflow: hidden;">
                        <div id="gsc-progress-bar" style="width: 0%; background: var(--color-success); height: 100%; transition: width 0.3s;"></div>
                    </div>
                </div>
            `;
            container.appendChild(progressDiv);
            
            gscCharacteristics.forEach((char, index) => {
                const div = document.createElement('div');
                div.className = 'gsc-detailed';
                
                const criteriaKey = `${char.id}. ${char.name}`;
                const criteria = gscDetailedCriteria[criteriaKey] || {};
                
                div.innerHTML = `
                    <div class="gsc-question card" style="border-left: 4px solid ${projectData.gscValues[index] > 0 ? 'var(--color-success)' : 'var(--color-border)'}; margin-bottom: 20px;">
                        <div class="card__body">
                            <div class="flex justify-between items-start" style="margin-bottom: 12px;">
                                <div style="flex: 1;">
                                    <h4 style="margin: 0; color: var(--color-text);">${char.id}. ${char.name}</h4>
                                    <p class="question" style="margin: 8px 0; font-size: 16px; font-weight: 500; color: var(--color-primary);">${char.question}</p>
                                    <p class="description" style="margin: 8px 0; color: var(--color-text-secondary);">${char.description}</p>
                                    <p class="example" style="margin: 8px 0; padding: 8px; background: var(--color-bg-2); border-radius: 4px; font-style: italic;">
                                        üí° <strong>Ejemplo:</strong> ${char.example}
                                    </p>
                                </div>
                                <div class="gsc-status" style="text-align: center; min-width: 60px;">
                                    ${projectData.gscValues[index] > 0 ? 
                                        `<div style="color: var(--color-success); font-size: 24px;">‚úÖ</div><div style="font-size: 12px; color: var(--color-success);">Completa</div>` : 
                                        `<div style="color: var(--color-warning); font-size: 24px;">‚ö†Ô∏è</div><div style="font-size: 12px; color: var(--color-warning);">Pendiente</div>`
                                    }
                                </div>
                            </div>
                            
                            <div class="radio-options" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px; margin-top: 16px;">
                                ${[0, 1, 2, 3, 4, 5].map(value => `
                                    <label class="gsc-option ${projectData.gscValues[index] === value ? 'selected' : ''}" 
                                           style="display: block; padding: 12px 8px; border: 2px solid ${projectData.gscValues[index] === value ? 'var(--color-primary)' : 'var(--color-border)'}; 
                                                  border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.2s; 
                                                  background: ${projectData.gscValues[index] === value ? 'var(--color-primary)' : 'var(--color-surface)'}; 
                                                  color: ${projectData.gscValues[index] === value ? 'var(--color-btn-primary-text)' : 'var(--color-text)'};" 
                                           onclick="selectGSC(${index}, ${value})">
                                        <input type="radio" name="gsc-${char.id}" value="${value}" ${projectData.gscValues[index] === value ? 'checked' : ''} style="margin: 0 0 4px 0;">
                                        <div style="font-weight: 600; font-size: 18px;">${value}</div>
                                        <div style="font-size: 11px; margin-top: 4px; opacity: 0.8;">${(criteria[value] || 'No definido').substring(0, 40)}${(criteria[value] || '').length > 40 ? '...' : ''}</div>
                                    </label>
                                `).join('')}
                            </div>
                            
                            <div class="gsc-criteria" style="margin-top: 16px; padding: 12px; background: var(--color-bg-1); border-radius: 6px; font-size: 13px;">
                                <strong>üìà Niveles de Evaluaci√≥n:</strong><br>
                                ${Object.entries(criteria).map(([level, desc]) => 
                                    `<div style="margin: 6px 0;"><strong style="color: var(--color-primary);">${level}:</strong> ${desc}</div>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(div);
            });
            
            // Actualizar progreso inicial
            updateGSCProgress();
        }

        function selectGSC(index, value) {
            projectData.gscValues[index] = value;
            
            // Update visual selection and regenerate the form to reflect changes
            generateGSCForm();
            
            // Update GSC totals and progress
            updateGSCTotals();
            updateGSCProgress();
            
            // Auto-save progress
            autoSave();
        }
        
        function updateGSCProgress() {
            const completed = projectData.gscValues.filter(val => val > 0).length;
            const progressPercent = (completed / 14) * 100;
            
            const completedElement = document.getElementById('gsc-completed');
            const progressBar = document.getElementById('gsc-progress-bar');
            const totalDisplay = document.getElementById('gsc-total-display');
            
            if (completedElement) completedElement.textContent = completed;
            if (progressBar) progressBar.style.width = progressPercent + '%';
            if (totalDisplay) {
                const gscSum = projectData.gscValues.reduce((sum, value) => sum + value, 0);
                totalDisplay.textContent = `GSC: ${gscSum}`;
            }
        }

        function updateGSCTotals() {
            const gscSum = projectData.gscValues.reduce((sum, value) => sum + value, 0);
            const vaf = 0.65 + (gscSum / 100);
            
            const totalElement = document.getElementById('gsc-total');
            const vafElement = document.getElementById('gsc-vaf');
            
            if (totalElement) totalElement.textContent = gscSum;
            if (vafElement) vafElement.textContent = vaf.toFixed(2);
            
            // Update progress display
            updateGSCProgress();
        }

        // Calculations
        function calculateResults() {
            // Calculate unadjusted function points
            let unadjustedFP = 0;
            Object.values(projectData.functions).forEach(functions => {
                functions.forEach(func => {
                    unadjustedFP += func.fpValue;
                });
            });
            
            // Calculate VAF
            const gscSum = projectData.gscValues.reduce((sum, value) => sum + value, 0);
            const vaf = 0.65 + (gscSum / 100);
            
            // Calculate adjusted function points
            const adjustedFP = unadjustedFP * vaf;
            
            // Calculate lines of code
            const languageFactor = languageFactors[projectData.language] || 53;
            const linesOfCode = Math.round(adjustedFP * languageFactor);
            
            // Update UI
            document.getElementById('unadjusted-fp').textContent = unadjustedFP.toFixed(0);
            document.getElementById('vaf').textContent = vaf.toFixed(3);
            document.getElementById('adjusted-fp').textContent = adjustedFP.toFixed(0);
            document.getElementById('lines-of-code').textContent = linesOfCode.toLocaleString();
            
            // Update language in results
            const selectedLangElement = document.getElementById('selected-language');
            if (selectedLangElement) {
                selectedLangElement.textContent = projectData.language;
            }
            
            // Generate project summary
            generateProjectSummary(unadjustedFP, adjustedFP, linesOfCode);
        }

        function generateProjectSummary(unadjustedFP, adjustedFP, linesOfCode) {
            const summary = document.getElementById('project-summary');
            
            const functionBreakdown = Object.entries(projectData.functions)
                .map(([type, functions]) => {
                    const total = functions.reduce((sum, func) => sum + func.fpValue, 0);
                    const typeNames = {
                        'entradas': 'ENTRADAS (EI)',
                        'salidas': 'SALIDAS (EO)',
                        'peticiones': 'PETICIONES (EQ)',
                        'archivos-internos': 'ARCHIVOS INTERNOS (ILF)',
                        'archivos-externos': 'ARCHIVOS EXTERNOS (EIF)'
                    };
                    return `<li>${typeNames[type] || type.toUpperCase()}: ${total} PF (${functions.length} elementos)</li>`;
                }).join('');
            
            const gscSum = projectData.gscValues.reduce((sum, value) => sum + value, 0);
            const vaf = 0.65 + (gscSum / 100);
            
            summary.innerHTML = `
                <h4>üìä Proyecto: ${projectData.name}</h4>
                <p><strong>Lenguaje:</strong> ${projectData.language} (${languageFactors[projectData.language] || 53} L√≠neas/PF)</p>
                <p><strong>Descripci√≥n:</strong> ${projectData.description}</p>
                
                <h5>üìä Distribuci√≥n de Puntos de Funci√≥n:</h5>
                <ul>${functionBreakdown}</ul>
                
                <h5>üéØ Caracter√≠sticas del Sistema (GSC):</h5>
                <ul>
                    <li>Suma Total GSC: ${gscSum} puntos</li>
                    <li>Factor de Ajuste de Valor (VAF): ${vaf.toFixed(3)}</li>
                    <li>F√≥rmula VAF: 0.65 + (${gscSum} / 100) = ${vaf.toFixed(3)}</li>
                </ul>
                
                <h5>üèÜ M√©tricas Finales:</h5>
                <ul>
                    <li><strong>Puntos de Funci√≥n No Ajustados (UFP):</strong> ${unadjustedFP.toFixed(0)} PF</li>
                    <li><strong>Puntos de Funci√≥n Ajustados (AFP):</strong> ${adjustedFP.toFixed(0)} PF</li>
                    <li><strong>L√≠neas de C√≥digo Estimadas (SLOC):</strong> ${linesOfCode.toLocaleString()} l√≠neas</li>
                    <li><strong>F√≥rmula AFP:</strong> ${unadjustedFP.toFixed(0)} √ó ${vaf.toFixed(3)} = ${adjustedFP.toFixed(0)} PF</li>
                    <li><strong>F√≥rmula SLOC:</strong> ${adjustedFP.toFixed(0)} √ó ${languageFactors[projectData.language] || 53} = ${linesOfCode.toLocaleString()} l√≠neas</li>
                </ul>
                
                <div style="margin-top: 20px; padding: 12px; background: var(--color-bg-3); border-radius: 8px;">
                    <h6>üìà Interpretaci√≥n de Resultados:</h6>
                    <p><strong>Tama√±o del Proyecto:</strong> ${adjustedFP <= 100 ? 'Peque√±o' : adjustedFP <= 500 ? 'Mediano' : 'Grande'}</p>
                    <p><strong>Complejidad:</strong> ${gscSum <= 20 ? 'Baja' : gscSum <= 40 ? 'Media' : 'Alta'} (GSC: ${gscSum}/70)</p>
                    <p><strong>Esfuerzo Estimado:</strong> ${Math.round(adjustedFP / 100 * 5)} a ${Math.round(adjustedFP / 100 * 8)} meses-persona (aprox.)</p>
                </div>
            `;
        }

        function exportToCSV() {
            // Validations
            if (!validateDataForExport()) {
                return;
            }
            
            const csvContent = generateCSVContent();
            
            // Create and download CSV file
            const BOM = '\uFEFF'; // UTF-8 BOM for Excel compatibility
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            
            // Generate intelligent filename
            const projectName = projectData.name.replace(/[^a-zA-Z0-9]/g, '_');
            const today = new Date().toISOString().slice(0, 10).replace(/-/g, '');
            a.download = `PuntosFuncion_${projectName}_${today}.csv`;
            
            a.click();
            URL.revokeObjectURL(url);
            
            // Show success message
            showExportMessage('‚úÖ Archivo CSV exportado exitosamente. Ya puedes abrirlo en Excel.');
        }
        
        function validateDataForExport() {
            // Check if project has name
            if (!projectData.name.trim()) {
                alert('‚ö†Ô∏è Por favor ingresa un nombre para el proyecto antes de exportar.');
                return false;
            }
            
            // Check if language is selected
            if (!projectData.language) {
                alert('‚ö†Ô∏è Por favor selecciona un lenguaje de programaci√≥n antes de exportar.');
                return false;
            }
            
            // Check if at least one function is defined
            const totalFunctions = Object.values(projectData.functions)
                .reduce((sum, functions) => sum + functions.length, 0);
            
            if (totalFunctions === 0) {
                alert('‚ö†Ô∏è Por favor define al menos una funci√≥n del sistema antes de exportar.');
                return false;
            }
            
            // Check if all GSC values are set (not all zeros is acceptable)
            const hasGSCValues = projectData.gscValues.some(value => value > 0);
            if (!hasGSCValues) {
                const confirm = window.confirm('‚ö†Ô∏è No has evaluado ninguna caracter√≠stica del sistema (GSC). ¬øDeseas continuar con la exportaci√≥n?');
                if (!confirm) return false;
            }
            
            return true;
        }
        
        function generateCSVContent() {
            const lines = [];
            const currentDate = new Date().toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit', 
                year: 'numeric'
            });
            
            // Header
            lines.push('CALCULADORA DE PUNTOS DE FUNCI√ìN - RESULTADOS');
            lines.push(`Proyecto:,${escapeCSVField(projectData.name)}`);
            lines.push(`Lenguaje:,${projectData.language}`);
            lines.push(`Fecha:,${currentDate}`);
            lines.push('============================================');
            lines.push('');
            
            // Function types data
            const functionTypes = {
                'entradas': { name: 'ENTRADAS', headers: ['N√∫m.', 'Entrada', 'Archivos referidos', 'Elementos de datos', 'Nivel', 'Valor'] },
                'salidas': { name: 'SALIDAS', headers: ['N√∫m.', 'Salida', 'Archivos referidos', 'Elementos de datos', 'Nivel', 'Valor'] },
                'peticiones': { name: 'PETICIONES', headers: ['N√∫m.', 'Petici√≥n', 'Archivos referidos', 'Elementos de datos', 'Nivel', 'Valor'] },
                'archivos-internos': { name: 'ARCHIVOS INTERNOS', headers: ['N√∫m.', 'Archivo interno', 'Elementos de registro', 'Elementos de datos', 'Nivel', 'Valor'] },
                'archivos-externos': { name: 'ARCHIVOS EXTERNOS', headers: ['N√∫m.', 'Archivo externo', 'Elementos de registro', 'Elementos de datos', 'Nivel', 'Valor'] }
            };
            
            Object.entries(functionTypes).forEach(([key, config]) => {
                const functions = projectData.functions[key] || [];
                lines.push(config.name);
                lines.push(config.headers.join(','));
                
                let subtotal = 0;
                functions.forEach((func, index) => {
                    const row = [
                        index + 1,
                        escapeCSVField(func.name || 'Sin nombre'),
                        func.files || 0,
                        func.elements || 0,
                        func.complexity || 'Bajo',
                        func.fpValue || 0
                    ];
                    lines.push(row.join(','));
                    subtotal += func.fpValue || 0;
                });
                
                if (functions.length === 0) {
                    lines.push('(No hay elementos definidos)');
                }
                lines.push(`Subtotal ${config.name.toLowerCase()},${subtotal}`);
                lines.push('');
            });
            
            // GSC Section
            lines.push('CARACTER√çSTICAS DEL SISTEMA (GSC)');
            lines.push('Caracter√≠stica,Valor,Descripci√≥n');
            
            gscCharacteristics.forEach((char, index) => {
                const value = projectData.gscValues[index] || 0;
                const description = getGSCDescription(char.name, value);
                lines.push(`${escapeCSVField(char.name)},${value},${escapeCSVField(description)}`);
            });
            
            const gscSum = projectData.gscValues.reduce((sum, value) => sum + value, 0);
            lines.push(`Suma GSC,${gscSum}`);
            lines.push('');
            
            // Final Results
            const unadjustedFP = parseInt(document.getElementById('unadjusted-fp').textContent);
            const vaf = parseFloat(document.getElementById('vaf').textContent);
            const adjustedFP = parseInt(document.getElementById('adjusted-fp').textContent);
            const linesOfCode = parseInt(document.getElementById('lines-of-code').textContent.replace(/,/g, ''));
            const languageFactor = languageFactors[projectData.language] || 53;
            
            lines.push('RESULTADOS FINALES');
            lines.push('M√©trica,Valor');
            lines.push(`Puntos de Funci√≥n No Ajustados,${unadjustedFP}`);
            lines.push(`Factor de Ajuste de Valor (VAF),${vaf.toFixed(3)}`);
            lines.push(`Puntos de Funci√≥n Ajustados,${adjustedFP}`);
            lines.push(`Factor de Conversi√≥n LDC,${languageFactor}`);
            lines.push(`L√≠neas de C√≥digo Estimadas,${linesOfCode}`);
            
            return lines.join('\n');
        }
        
        function escapeCSVField(field) {
            if (typeof field !== 'string') {
                field = String(field);
            }
            
            // If field contains comma, quotes, or newlines, wrap in quotes and escape internal quotes
            if (field.includes(',') || field.includes('"') || field.includes('\n')) {
                return '"' + field.replace(/"/g, '""') + '"';
            }
            return field;
        }
        
        function getGSCDescription(charName, value) {
            const criteriaKey = gscCharacteristics.find(c => c.name === charName)?.id + ". " + charName;
            const criteria = gscDetailedCriteria[criteriaKey];
            if (criteria && criteria[value]) {
                return criteria[value].substring(0, 100) + (criteria[value].length > 100 ? '...' : '');
            }
            return `Valor ${value} seleccionado`;
        }
        
        function showExportMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.innerHTML = message;
            messageDiv.style.cssText = `
                position: fixed; 
                top: 20px; 
                right: 20px; 
                background: var(--color-success); 
                color: white; 
                padding: 16px 20px; 
                border-radius: 8px; 
                box-shadow: var(--shadow-lg); 
                z-index: 2000;
                max-width: 350px;
                font-weight: 500;
            `;
            
            document.body.appendChild(messageDiv);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                messageDiv.style.opacity = '0';
                messageDiv.style.transition = 'opacity 0.3s';
                setTimeout(() => messageDiv.remove(), 300);
            }, 4000);
        }

        function resetProject() {
            const confirmReset = confirm('üîÑ ¬øEst√°s seguro de que deseas reiniciar? Se perder√° todo el progreso actual.');
            if (!confirmReset) return;
            
            projectData = {
                name: '',
                language: '',
                description: '',
                functions: {
                    entradas: [],
                    salidas: [],
                    peticiones: [],
                    'archivos-internos': [],
                    'archivos-externos': []
                },
                gscValues: Array(14).fill(0)
            };
            
            // Clear saved data (in-memory)
            savedProjectData = null;
            
            // Clear all tables
            Object.keys(projectData.functions).forEach(type => {
                const tbody = document.getElementById(type + '-tbody');
                if (tbody) tbody.innerHTML = '';
                updateSubtotal(type);
            });
            
            // Reset form fields
            const nameField = document.getElementById('project-name');
            const langField = document.getElementById('programming-language');
            const descField = document.getElementById('project-description');
            
            if (nameField) nameField.value = '';
            if (langField) langField.value = '';
            if (descField) descField.value = '';
            
            // Reset status
            isDataChanged = false;
            updateSaveStatus('‚úÖ Nuevo proyecto', 'var(--color-success)');
            
            showSaveMessage('üÜï Proyecto reiniciado (datos en memoria limpiados)');
            showSection('home-section');
        }

        function openHelpModal() {
            document.getElementById('help-modal').style.display = 'block';
        }

        function closeHelpModal() {
            document.getElementById('help-modal').style.display = 'none';
        }

        function printResults() {
            window.print();
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('help-modal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Add print styles
        const printStyles = document.createElement('style');
        printStyles.innerHTML = `
            @media print {
                .nav-buttons, .tabs, .btn { display: none !important; }
                .app-section:not(#results-section) { display: none !important; }
                #results-section { display: block !important; }
                .container { max-width: 100% !important; padding: 0 !important; }
                .results-grid { grid-template-columns: repeat(2, 1fr) !important; }
            }
        `;
        document.head.appendChild(printStyles);

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + H for help
            if ((e.ctrlKey || e.metaKey) && e.key === 'h') {
                e.preventDefault();
                openHelpModal();
            }
            // Escape to close modal
            if (e.key === 'Escape') {
                closeHelpModal();
            }
        });

        // Add auto-save interval management
        function startAutoSave() {
            // Auto-save every 30 seconds
            autoSaveInterval = setInterval(() => {
                if (isDataChanged) {
                    autoSave();
                }
            }, 30000);
        }
        
        function stopAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
                autoSaveInterval = null;
            }
        }
        
        // Prevent data loss on page unload
        window.addEventListener('beforeunload', function(e) {
            if (isDataChanged) {
                const message = '¬øEst√°s seguro? Tienes trabajo sin guardar que se perder√° al cerrar la p√°gina.';
                e.preventDefault();
                e.returnValue = message;
                return message;
            }
        });
        
        // Initialize the application with recovery system
        document.addEventListener('DOMContentLoaded', function() {
            // Check for saved data
            const savedData = loadSavedData();
            if (savedData && (savedData.name || savedData.language || 
                Object.values(savedData.functions).some(arr => arr.length > 0) ||
                savedData.gscValues.some(val => val > 0))) {
                showRecoveryModal(savedData);
            }
            
            // Initialize empty rows for each function type
            Object.keys(projectData.functions).forEach(type => {
                updateSubtotal(type);
            });
            
            // Start auto-save system
            startAutoSave();
            
            // Add save status indicator
            addSaveStatusIndicator();
            
            // Add manual save button
            addManualSaveButton();
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl/Cmd + S for manual save
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    manualSave();
                }
            });
            
            // Add event listeners to form inputs
            ['project-name', 'programming-language', 'project-description'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', markDataAsChanged);
                    element.addEventListener('change', markDataAsChanged);
                }
            });
        });
        
        function addSaveStatusIndicator() {
            const indicator = document.createElement('div');
            indicator.id = 'save-status-container';
            indicator.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 2000;
                background: var(--color-surface);
                padding: 8px 16px;
                border-radius: 20px;
                border: 1px solid var(--color-border);
                box-shadow: var(--shadow-sm);
                font-size: 12px;
                font-weight: 500;
            `;
            
            indicator.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div id="save-status" style="color: var(--color-success);">‚úÖ Guardado</div>
                    <div id="last-save-time" style="color: var(--color-text-secondary); font-size: 11px;"></div>
                </div>
            `;
            
            document.body.appendChild(indicator);
            
            // Update timestamp every minute
            setInterval(updateLastSaveDisplay, 60000);
        }
        
        function updateLastSaveDisplay() {
            const element = document.getElementById('last-save-time');
            if (element && lastSaveTime) {
                const minutes = Math.floor((Date.now() - lastSaveTime) / 60000);
                if (minutes === 0) {
                    element.textContent = 'Ahora';
                } else if (minutes === 1) {
                    element.textContent = 'Hace 1 min';
                } else {
                    element.textContent = `Hace ${minutes} min`;
                }
            }
        }
        
        function addManualSaveButton() {
            const saveBtn = document.createElement('button');
            saveBtn.className = 'btn btn--primary';
            saveBtn.innerHTML = 'üíæ Guardar Progreso';
            saveBtn.onclick = manualSave;
            saveBtn.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 2000;
                box-shadow: var(--shadow-lg);
                background: var(--color-success) !important;
            `;
            
            document.body.appendChild(saveBtn);
        }
    </script>
</body>
</html>
